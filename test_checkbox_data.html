<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Checkbox Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .checkbox-group { margin: 10px 0; }
        .checkbox-group label { display: inline-block; margin-right: 15px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        #output { margin-top: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <h1>Test Checkbox Data Submission</h1>
    
    <div class="test-section">
        <h3>Peserta 1</h3>
        <div>
            <label>Nama: <input type="text" id="peserta_nama_1" name="peserta_nama_1" value="Test Peserta 1"></label>
        </div>
        <div>
            <label>No K/P: <input type="text" id="peserta_nokp_1" name="peserta_nokp_1" value="123456789012"></label>
        </div>
        <div class="checkbox-group">
            <label><input type="checkbox" id="peserta_cwb_1" name="peserta_cwb_1"> CWB (Child with Bag)</label>
            <label><input type="checkbox" id="peserta_infant_1" name="peserta_infant_1"> Infant</label>
            <label><input type="checkbox" id="peserta_cnb_1" name="peserta_cnb_1"> CNB (Child No Bag)</label>
        </div>
    </div>

    <div class="test-section">
        <h3>Peserta 2</h3>
        <div>
            <label>Nama: <input type="text" id="peserta_nama_2" name="peserta_nama_2" value="Test Peserta 2"></label>
        </div>
        <div>
            <label>No K/P: <input type="text" id="peserta_nokp_2" name="peserta_nokp_2" value="987654321098"></label>
        </div>
        <div class="checkbox-group">
            <label><input type="checkbox" id="peserta_cwb_2" name="peserta_cwb_2"> CWB (Child with Bag)</label>
            <label><input type="checkbox" id="peserta_infant_2" name="peserta_infant_2"> Infant</label>
            <label><input type="checkbox" id="peserta_cnb_2" name="peserta_cnb_2"> CNB (Child No Bag)</label>
        </div>
    </div>

    <button onclick="testFormData()">Test Form Data</button>
    <button onclick="testServerSubmission()">Test Server Submission</button>

    <div id="output"></div>

    <script>
        function testFormData() {
            const formData = new FormData();
            
            // Add peserta 1 data
            formData.append('peserta_nama_1', document.getElementById('peserta_nama_1').value);
            formData.append('peserta_nokp_1', document.getElementById('peserta_nokp_1').value);
            formData.append('peserta_cwb_1', document.getElementById('peserta_cwb_1').checked ? 'on' : '');
            formData.append('peserta_infant_1', document.getElementById('peserta_infant_1').checked ? 'on' : '');
            formData.append('peserta_cnb_1', document.getElementById('peserta_cnb_1').checked ? 'on' : '');
            
            // Add peserta 2 data
            formData.append('peserta_nama_2', document.getElementById('peserta_nama_2').value);
            formData.append('peserta_nokp_2', document.getElementById('peserta_nokp_2').value);
            formData.append('peserta_cwb_2', document.getElementById('peserta_cwb_2').checked ? 'on' : '');
            formData.append('peserta_infant_2', document.getElementById('peserta_infant_2').checked ? 'on' : '');
            formData.append('peserta_cnb_2', document.getElementById('peserta_cnb_2').checked ? 'on' : '');
            
            // Display form data
            let output = '<h4>Form Data Entries:</h4><ul>';
            for (const [key, value] of formData.entries()) {
                output += `<li><strong>${key}:</strong> ${value}</li>`;
            }
            output += '</ul>';
            
            // Simulate server processing
            const pesertaMap = new Map();
            for (const [key, value] of formData.entries()) {
                let match = /^peserta_nama_(\d+)$/.exec(String(key));
                if (match) {
                    const id = match[1];
                    const existing = pesertaMap.get(id) || {};
                    existing.nama = String(value || '').trim();
                    pesertaMap.set(id, existing);
                    continue;
                }
                match = /^peserta_nokp_(\d+)$/.exec(String(key));
                if (match) {
                    const id = match[1];
                    const existing = pesertaMap.get(id) || {};
                    existing.nokp = String(value || '');
                    pesertaMap.set(id, existing);
                    continue;
                }
                match = /^peserta_cwb_(\d+)$/.exec(String(key));
                if (match) {
                    const id = match[1];
                    const existing = pesertaMap.get(id) || {};
                    existing.cwb = value === 'on';
                    pesertaMap.set(id, existing);
                    continue;
                }
                match = /^peserta_infant_(\d+)$/.exec(String(key));
                if (match) {
                    const id = match[1];
                    const existing = pesertaMap.get(id) || {};
                    existing.infant = value === 'on';
                    pesertaMap.set(id, existing);
                    continue;
                }
                match = /^peserta_cnb_(\d+)$/.exec(String(key));
                if (match) {
                    const id = match[1];
                    const existing = pesertaMap.get(id) || {};
                    existing.cnb = value === 'on';
                    pesertaMap.set(id, existing);
                }
            }
            
            output += '<h4>Processed Peserta Data:</h4><ul>';
            for (const [id, peserta] of pesertaMap.entries()) {
                output += `<li><strong>Peserta ${id}:</strong> nama="${peserta.nama}", nokp="${peserta.nokp}", cwb=${peserta.cwb}, infant=${peserta.infant}, cnb=${peserta.cnb}</li>`;
            }
            output += '</ul>';
            
            document.getElementById('output').innerHTML = output;
        }

        async function testServerSubmission() {
            const formData = new FormData();
            
            // Add required fields for booking
            formData.append('gelaran', 'Encik');
            formData.append('nama', 'Test User');
            formData.append('nokp', '123456789012');
            formData.append('telefon', '0123456789');
            formData.append('email', 'test@example.com');
            formData.append('alamat', 'Test Address');
            formData.append('poskod', '12345');
            formData.append('negeri', 'Selangor');
            formData.append('bandar', 'Shah Alam');
            formData.append('cawangan', 'test-branch-id');
            formData.append('pakej', 'test-package-id');
            formData.append('bilangan', '2');
            
            // Add peserta 1 data
            formData.append('peserta_nama_1', document.getElementById('peserta_nama_1').value);
            formData.append('peserta_nokp_1', document.getElementById('peserta_nokp_1').value);
            formData.append('peserta_cwb_1', document.getElementById('peserta_cwb_1').checked ? 'on' : '');
            formData.append('peserta_infant_1', document.getElementById('peserta_infant_1').checked ? 'on' : '');
            formData.append('peserta_cnb_1', document.getElementById('peserta_cnb_1').checked ? 'on' : '');
            
            // Add peserta 2 data
            formData.append('peserta_nama_2', document.getElementById('peserta_nama_2').value);
            formData.append('peserta_nokp_2', document.getElementById('peserta_nokp_2').value);
            formData.append('peserta_cwb_2', document.getElementById('peserta_cwb_2').checked ? 'on' : '');
            formData.append('peserta_infant_2', document.getElementById('peserta_infant_2').checked ? 'on' : '');
            formData.append('peserta_cnb_2', document.getElementById('peserta_cnb_2').checked ? 'on' : '');
            
            try {
                const response = await fetch('/', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.text();
                document.getElementById('output').innerHTML = '<h4>Server Response:</h4><pre>' + result + '</pre>';
            } catch (error) {
                document.getElementById('output').innerHTML = '<h4>Error:</h4><pre>' + error.message + '</pre>';
            }
        }
    </script>
</body>
</html>
